{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Tool\\System/assets\\Script\\Tool\\System\\JsonDataTool.js"],"names":["outModule","localJsonDataSave","INTI_DATA_KEY","init","finishCb","cc","loader","loadResDir","err","objects","urls","forEach","oneUrl","index","replace","keyName","array","oneData","push","getDataByKey","tableName","key","value","table","getTableByName","g_LogTool","showLog","getDataById","id","object","undefined","module","exports"],"mappings":";;;;;;AAAA;AACA;;;;AAIA,IAAIA,YAAY,EAAhB;AACA;AACA;AACA,IAAIC,oBAAoB,EAAxB;;AAEA;;;;AAIA,IAAMC,gBAAgB;AAClB,kCAA8B,CAC1B,eAD0B,CADZ;AAIlB,wBAAoB,CAChB,UADgB;AAJF,CAAtB;;AASA;;;;AAIAF,UAAUG,IAAV,GAAiB,UAACC,QAAD,EAAc;AAC3BC,OAAGC,MAAH,CAAUC,UAAV,CAAqB,YAArB,EAAmC,UAAUC,GAAV,EAAeC,OAAf,EAAwBC,IAAxB,EAA8B;AAC7DA,aAAKC,OAAL,CAAa,UAAUC,MAAV,EAAkBC,KAAlB,EAAyB;AAClCD,qBAASA,OAAOE,OAAP,CAAe,aAAf,EAA8B,EAA9B,CAAT;AACAb,8BAAkBW,MAAlB,IAA4BH,QAAQI,KAAR,CAA5B;AACA;AACA,gBAAIX,cAAcU,MAAd,CAAJ,EAA2B;AACvBV,8BAAcU,MAAd,EAAsBD,OAAtB,CAA8B,UAACI,OAAD,EAAa;AACvCd,sCAAkBW,MAAlB,EAA0BG,OAA1B,IAAqC,EAArC;AACAd,sCAAkBW,MAAlB,EAA0BI,KAA1B,CAAgCL,OAAhC,CAAwC,UAACM,OAAD,EAAa;AACjD;AACA,4BAAI,CAAChB,kBAAkBW,MAAlB,EAA0BG,OAA1B,EAAmCE,QAAQF,OAAR,CAAnC,CAAL,EAA2D;AACvDd,8CAAkBW,MAAlB,EAA0BG,OAA1B,EAAmCE,QAAQF,OAAR,CAAnC,IAAuD,EAAvD;AACH;AACDd,0CAAkBW,MAAlB,EAA0BG,OAA1B,EAAmCE,QAAQF,OAAR,CAAnC,EAAqDG,IAArD,CAA0DD,OAA1D;AACH,qBAND;AAOH,iBATD;AAUH;AACJ,SAhBD;AAiBA,YAAIb,QAAJ,EAAc;AACVA;AACH;AACJ,KArBD;AAsBH,CAvBD;;AAyBA;;;;;;AAMAJ,UAAUmB,YAAV,GAAyB,UAACC,SAAD,EAAYC,GAAZ,EAAiBC,KAAjB,EAA2B;AAChD,QAAIC,QAAQvB,UAAUwB,cAAV,CAAyBJ,SAAzB,CAAZ;AACA,QAAIG,SAASA,MAAMF,GAAN,CAAb,EAAyB;AACrB,eAAOE,MAAMF,GAAN,EAAWC,KAAX,CAAP;AACH,KAFD,MAEO;AACHG,kBAAUC,OAAV,wCAAuDL,GAAvD;AACH;AACD,WAAO,EAAP;AACH,CARD;;AAUA;;;;AAIArB,UAAUwB,cAAV,GAA2B,UAACJ,SAAD,EAAe;AACtC,WAAOnB,kBAAkBmB,SAAlB,CAAP;AACH,CAFD;;AAIA;;;;;AAKApB,UAAU2B,WAAV,GAAwB,UAACP,SAAD,EAAYQ,EAAZ,EAAmB;AACvC,QAAI3B,kBAAkBmB,SAAlB,CAAJ,EAAkC;AAC9B,eAAOnB,kBAAkBmB,SAAlB,EAA6BS,MAA7B,CAAoCD,EAApC,CAAP;AACH;AACD,WAAOE,SAAP;AACH,CALD;;AAOAC,OAAOC,OAAP,GAAiBhC,SAAjB","file":"JsonDataTool.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Tool\\System","sourcesContent":["/*global module, require, cc, client */\r\n/**\r\n * @desc 获取配置刷出来的JSON数据\r\n * @author Administrator\r\n */\r\nvar outModule = {};\r\n//以名字来做key\r\n//一个key对应一个obj，obj里面有两个属性，一个是object（用对象的方式组织数据），一个是array（用数组的方式实现）\r\nvar localJsonDataSave = {};\r\n\r\n/**\r\n * 一般来说数据组成都是mian_id为key，为了减少调用getDataByKey函数的时间，会对指定的表进行处理，按指定的key再生成一遍数据\r\n * 如会对_table_attribute_attribute表格进行处理，以attributeName为key绑定一个数据\r\n */\r\nconst INTI_DATA_KEY = {\r\n    '_table_attribute_attribute': [\r\n        'attributeName'\r\n    ],\r\n    '_table_unit_unit': [\r\n        'unitType'\r\n    ]\r\n};\r\n\r\n/**\r\n * 异步加载\r\n * @param {Function} finishCb \r\n */\r\noutModule.init = (finishCb) => {\r\n    cc.loader.loadResDir('Excel_Data', function (err, objects, urls) {\r\n        urls.forEach(function (oneUrl, index) {\r\n            oneUrl = oneUrl.replace(\"Excel_Data/\", \"\");\r\n            localJsonDataSave[oneUrl] = objects[index];\r\n            //对INTI_DATA_KEY的数据进行处理\r\n            if (INTI_DATA_KEY[oneUrl]) {\r\n                INTI_DATA_KEY[oneUrl].forEach((keyName) => {\r\n                    localJsonDataSave[oneUrl][keyName] = {};\r\n                    localJsonDataSave[oneUrl].array.forEach((oneData) => {\r\n                        //不是以id为key的情况时可能包括多个\r\n                        if (!localJsonDataSave[oneUrl][keyName][oneData[keyName]]) {\r\n                            localJsonDataSave[oneUrl][keyName][oneData[keyName]] = [];\r\n                        }\r\n                        localJsonDataSave[oneUrl][keyName][oneData[keyName]].push(oneData);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n        if (finishCb) {\r\n            finishCb();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * 根据一个key值来获取数据，返回一个数组\r\n * @param {String} tableName \r\n * @param {String} key \r\n * @param {Number | String} value \r\n */\r\noutModule.getDataByKey = (tableName, key, value) => {\r\n    let table = outModule.getTableByName(tableName);\r\n    if (table && table[key]) {\r\n        return table[key][value];\r\n    } else {\r\n        g_LogTool.showLog(`INTI_DATA_KEY not have this key : ${key}`);\r\n    }\r\n    return [];\r\n};\r\n\r\n/**\r\n * 返回一个指定的数据表\r\n * @param {String} tableName \r\n */\r\noutModule.getTableByName = (tableName) => {\r\n    return localJsonDataSave[tableName];\r\n};\r\n\r\n/**\r\n * 返回一个指定id的数据\r\n * @param {String} tableName \r\n * @param {Number} id \r\n */\r\noutModule.getDataById = (tableName, id) => {\r\n    if (localJsonDataSave[tableName]) {\r\n        return localJsonDataSave[tableName].object[id];\r\n    }\r\n    return undefined;\r\n};\r\n\r\nmodule.exports = outModule;"]}