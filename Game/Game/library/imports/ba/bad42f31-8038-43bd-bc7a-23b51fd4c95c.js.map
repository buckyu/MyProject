{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Data\\Battle/assets\\Script\\Data\\Battle\\BattleFactory.js"],"names":["outModule","local","buildOneBattle","person_1","person_2","_person_1","_person_2","timeUpdate","attack_1","attack_2","_attack","isPersonHeadAttack","totalNum","cc","random0To1","hurtNum","personAttack","personDef","_def","_nowHp","deadCb","battleFinishCb","module","exports"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,YAAY,EAAhB;AACA,IAAIC,QAAQ,EAAZ;;AAEA;;;AAGAD,UAAUE,cAAV,GAA2B,UAAUC,QAAV,EAAoBC,QAApB,EAA8B;AACrD,SAAKC,SAAL,GAAiBF,QAAjB;AACA,SAAKG,SAAL,GAAiBF,QAAjB;;AAEA;;;AAGA,SAAKG,UAAL,GAAkB,YAAY;AAC1B;AACA;AACA,YAAIC,iBAAJ;AAAA,YAAcC,iBAAd;AACAD,mBAAW,KAAKH,SAAL,CAAeK,OAA1B;AACAD,mBAAW,KAAKH,SAAL,CAAeI,OAA1B;AACA;AACA,YAAIC,qBAAqB,KAAzB;AACA;AACA,YAAIC,WAAWJ,WAAWC,QAA1B;AACA,YAAII,GAAGC,UAAH,KAAmBN,WAAWI,QAAlC,EAA6C;AACzCD,iCAAqB,IAArB;AACH;AACD,YAAII,gBAAJ;AAAA,YAAaC,qBAAb;AAAA,YAA2BC,kBAA3B;AACA,YAAIN,kBAAJ,EAAwB;AACpBK,2BAAeb,QAAf;AACAc,wBAAYb,QAAZ;AACH,SAHD,MAGO;AACHY,2BAAeZ,QAAf;AACAa,wBAAYd,QAAZ;AACH;AACDY,kBAAUC,aAAaN,OAAb,GAAuBO,UAAUC,IAA3C;AACAH,kBAAUA,UAAU,CAAV,GAAc,CAAd,GAAkBA,OAA5B;AACAE,kBAAUE,MAAV,GAAmBF,UAAUE,MAAV,GAAmBJ,OAAtC;AACA,YAAIE,UAAUE,MAAV,GAAmB,CAAvB,EAA0B;AACtBF,sBAAUE,MAAV,GAAmB,CAAnB;AACAF,sBAAUG,MAAV,CAAiBJ,YAAjB;AACAC,sBAAUI,cAAV;AACAL,yBAAaK,cAAb;AACA,mBAAO,IAAP;AACH;AACDN,kBAAUE,UAAUP,OAAV,GAAoBM,aAAaE,IAA3C;AACAH,kBAAUA,UAAU,CAAV,GAAc,CAAd,GAAkBA,OAA5B;AACAC,qBAAaG,MAAb,GAAsBH,aAAaG,MAAb,GAAsBJ,OAA5C;AACA,YAAIC,aAAaG,MAAb,GAAsB,CAA1B,EAA6B;AACzBH,yBAAaG,MAAb,GAAsB,CAAtB;AACAH,yBAAaI,MAAb,CAAoBH,SAApB;AACAD,yBAAaK,cAAb;AACAJ,sBAAUI,cAAV;AACA,mBAAO,IAAP;AACH;AACD,eAAO,KAAP;AACH,KA1CD;AA2CH,CAlDD;;AAoDAC,OAAOC,OAAP,GAAiBvB,SAAjB","file":"BattleFactory.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Data\\Battle","sourcesContent":["/**\r\n * 战斗生成工厂\r\n */\r\nvar outModule = {};\r\nvar local = {};\r\n\r\n/**\r\n * 生成一个战斗\r\n */\r\noutModule.buildOneBattle = function (person_1, person_2) {\r\n    this._person_1 = person_1;\r\n    this._person_2 = person_2;\r\n\r\n    /**\r\n     * 返回true表示结束战斗\r\n     */\r\n    this.timeUpdate = function () {\r\n        //战斗开始\r\n        //根据武力计算谁先手\r\n        let attack_1, attack_2;\r\n        attack_1 = this._person_1._attack;\r\n        attack_2 = this._person_2._attack;\r\n        //表示person_1先手攻击\r\n        let isPersonHeadAttack = false;\r\n        //随机先手\r\n        let totalNum = attack_1 + attack_2;\r\n        if (cc.random0To1() < (attack_1 / totalNum)) {\r\n            isPersonHeadAttack = true;\r\n        }\r\n        let hurtNum, personAttack, personDef;\r\n        if (isPersonHeadAttack) {\r\n            personAttack = person_1;\r\n            personDef = person_2; \r\n        } else {\r\n            personAttack = person_2;\r\n            personDef = person_1; \r\n        }\r\n        hurtNum = personAttack._attack - personDef._def;\r\n        hurtNum = hurtNum < 0 ? 0 : hurtNum;\r\n        personDef._nowHp = personDef._nowHp - hurtNum;\r\n        if (personDef._nowHp < 0) {\r\n            personDef._nowHp = 0;\r\n            personDef.deadCb(personAttack);\r\n            personDef.battleFinishCb();\r\n            personAttack.battleFinishCb();\r\n            return true;\r\n        }\r\n        hurtNum = personDef._attack - personAttack._def;\r\n        hurtNum = hurtNum < 0 ? 0 : hurtNum;\r\n        personAttack._nowHp = personAttack._nowHp - hurtNum;\r\n        if (personAttack._nowHp < 0) {\r\n            personAttack._nowHp = 0;\r\n            personAttack.deadCb(personDef);\r\n            personAttack.battleFinishCb();\r\n            personDef.battleFinishCb();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n};\r\n\r\nmodule.exports = outModule;"]}