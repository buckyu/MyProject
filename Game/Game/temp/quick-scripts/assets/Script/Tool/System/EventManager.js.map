{"version":3,"sources":["EventManager.js"],"names":["outModule","local","eventSaveObj","findFuncIndex","eventName","func","undefined","i","len","length","on","thisObj","push","off","index","splice","send","arguments","argArr","forEach","oneFuncObj","cc","sys","isNative","apply","e","module","exports"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,YAAY,EAAhB;AACA,IAAIC,QAAQ,EAAZ;;AAEA;AACAA,MAAMC,YAAN,GAAqB,EAArB;;AAEA;;;;;AAKAD,MAAME,aAAN,GAAsB,UAAUC,SAAV,EAAqBC,IAArB,EAA2B;AAC7C,QAAI,CAACJ,MAAMC,YAAN,CAAmBE,SAAnB,CAAL,EAAoC;AAChC,eAAOE,SAAP;AACH;AACD,QAAIC,UAAJ;AAAA,QAAOC,YAAP;AACA,SAAKD,IAAI,CAAJ,EAAOC,MAAMP,MAAMC,YAAN,CAAmBE,SAAnB,EAA8BK,MAAhD,EAAwDF,IAAIC,GAA5D,EAAiED,GAAjE,EAAsE;AAClE,YAAIN,MAAMC,YAAN,CAAmBE,SAAnB,EAA8BG,CAA9B,EAAiCF,IAAjC,KAA0CA,IAA9C,EAAoD;AAChD,mBAAOE,CAAP;AACH;AACJ;AACD,WAAOD,SAAP;AACH,CAXD;;AAaA;;;;;;AAMAN,UAAUU,EAAV,GAAe,UAAUN,SAAV,EAAqBC,IAArB,EAA2BM,OAA3B,EAAoC;AAC/C,QAAI,CAACV,MAAMC,YAAN,CAAmBE,SAAnB,CAAL,EAAoC;AAChCH,cAAMC,YAAN,CAAmBE,SAAnB,IAAgC,EAAhC;AACH;AACD;AACA,QAAIH,MAAME,aAAN,CAAoBC,SAApB,EAA+BC,IAA/B,CAAJ,EAA0C;AACtC;AACH;AACDJ,UAAMC,YAAN,CAAmBE,SAAnB,EAA8BQ,IAA9B,CAAmC;AAC/BP,cAAMA,IADyB;AAE/BM,iBAASA;AAFsB,KAAnC;AAIH,CAZD;;AAcA;;;;;;AAMAX,UAAUa,GAAV,GAAgB,UAAUT,SAAV,EAAqBC,IAArB,EAA2B;AACvC,QAAI,CAACJ,MAAMC,YAAN,CAAmBE,SAAnB,CAAL,EAAoC;AAChC;AACH;AACD,QAAIU,QAAQb,MAAME,aAAN,CAAoBC,SAApB,EAA+BC,IAA/B,CAAZ;AACA,QAAIS,UAAUR,SAAd,EAAyB;AACrBL,cAAMC,YAAN,CAAmBE,SAAnB,EAA8BW,MAA9B,CAAqCD,KAArC,EAA4C,CAA5C;AACH;AACJ,CARD;;AAUA;AACAd,UAAUgB,IAAV,GAAiB,YAAY;AACzB,QAAIZ,YAAYa,UAAU,CAAV,CAAhB;AACA,QAAI,CAAChB,MAAMC,YAAN,CAAmBE,SAAnB,CAAL,EAAoC;AAChC;AACH;AACD;AACA,QAAIc,SAAS,EAAb;AACA,QAAIX,UAAJ;AAAA,QAAOC,YAAP;AACA,SAAKD,IAAI,CAAJ,EAAOC,MAAMS,UAAUR,MAA5B,EAAoCF,IAAIC,GAAxC,EAA6CD,GAA7C,EAAkD;AAC9CW,eAAON,IAAP,CAAYK,UAAUV,CAAV,CAAZ;AACH;AACDN,UAAMC,YAAN,CAAmBE,SAAnB,EAA8Be,OAA9B,CAAsC,UAAUC,UAAV,EAAsB;AACxD;AACA,YAAIC,GAAGC,GAAH,CAAOC,QAAX,EAAqB;AACjB,gBAAI;AACAH,2BAAWf,IAAX,CAAgBmB,KAAhB,CAAsBJ,WAAWT,OAAjC,EAA0CO,MAA1C;AACH,aAFD,CAEE,OAAOO,CAAP,EAAU,CAEX;AACJ,SAND,MAMO;AACHL,uBAAWf,IAAX,CAAgBmB,KAAhB,CAAsBJ,WAAWT,OAAjC,EAA0CO,MAA1C;AACH;AACJ,KAXD;AAYH,CAvBD;;AAyBAQ,OAAOC,OAAP,GAAiB3B,SAAjB","file":"EventManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Tool\\System","sourcesContent":["/**\r\n * 消息模块\r\n */\r\nvar outModule = {};\r\nvar local = {};\r\n\r\n//存储事件数据\r\nlocal.eventSaveObj = {};\r\n\r\n/**\r\n * 查找一个回调函数所处的index\r\n * @param {String} eventName \r\n * @param {Function} func \r\n */\r\nlocal.findFuncIndex = function (eventName, func) {\r\n    if (!local.eventSaveObj[eventName]) {\r\n        return undefined;\r\n    }\r\n    let i, len;\r\n    for (i = 0, len = local.eventSaveObj[eventName].length; i < len; i++) {\r\n        if (local.eventSaveObj[eventName][i].func === func) {\r\n            return i;\r\n        }\r\n    }\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * 同一个函数在一个事件下只能监听一次\r\n * @param {String} eventName \r\n * @param {Function} func \r\n * @param {Object} thisObj this，记录了当前调用的作用域\r\n */\r\noutModule.on = function (eventName, func, thisObj) {\r\n    if (!local.eventSaveObj[eventName]) {\r\n        local.eventSaveObj[eventName] = [];\r\n    }\r\n    //判断是否添加了\r\n    if (local.findFuncIndex(eventName, func)) {\r\n        return;\r\n    }\r\n    local.eventSaveObj[eventName].push({\r\n        func: func,\r\n        thisObj: thisObj\r\n    });\r\n};\r\n\r\n/**\r\n * 取消监听\r\n * @param {String} eventName 事件名称\r\n * @param {Function} func 函数指针，可以通过函数指针判定一个函数是否相等\r\n * 默认一个事件下的一个函数只能被注册一次\r\n */\r\noutModule.off = function (eventName, func) {\r\n    if (!local.eventSaveObj[eventName]) {\r\n        return;\r\n    }\r\n    let index = local.findFuncIndex(eventName, func);\r\n    if (index !== undefined) {\r\n        local.eventSaveObj[eventName].splice(index, 1);\r\n    }\r\n};\r\n\r\n//发送消息\r\noutModule.send = function () {\r\n    let eventName = arguments[0];\r\n    if (!local.eventSaveObj[eventName]) {\r\n        return;\r\n    }\r\n    //组织参数\r\n    let argArr = [];\r\n    let i, len;\r\n    for (i = 1, len = arguments.length; i < len; i++) {\r\n        argArr.push(arguments[i]);\r\n    }\r\n    local.eventSaveObj[eventName].forEach(function (oneFuncObj) {\r\n        //本地的时候需要调用try\r\n        if (cc.sys.isNative) {\r\n            try {\r\n                oneFuncObj.func.apply(oneFuncObj.thisObj, argArr);\r\n            } catch (e) {\r\n\r\n            }\r\n        } else {\r\n            oneFuncObj.func.apply(oneFuncObj.thisObj, argArr);\r\n        }\r\n    });\r\n};\r\n\r\nmodule.exports = outModule;"]}