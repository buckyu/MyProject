{"version":3,"sources":["ActionFactory.js"],"names":["outModule","local","buildFunc","action","doAction","personData","_isDoing","_pos","buildingId","goToBuilding","_nowUseTime","timeUpdate","addMinutes","cityId","buildingData","g_GameGlobalManager","gameData","getCityById","getBuildingById","_homePos","_actionCostTime","useBuilding","useHome","actionFinishCb","getSaveData","id","_id","nowUseTime","createOneAction","actionId","parseInt","jsonData","g_JsonDataTool","getDataById","costTime","pos","_rewardArr","rewardArr","split","_name","name","_costPower","costPower","_costMoney","costMoney","createOneActionSaveData","saveData","module","exports"],"mappings":"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","file":"ActionFactory.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Data\\Action","sourcesContent":["/**\r\n * 任务工厂\r\n */\r\nvar outModule = {};\r\nvar local = {};\r\n\r\n/**\r\n * @param action 已经加好数据的任务，再增加一些操作函数\r\n */\r\nlocal.buildFunc = function (action) {\r\n    //执行动作，返回一个是否开始做了\r\n    action.doAction = function (personData) {\r\n        //开始做的话就直接返回\r\n        if (action._isDoing) {\r\n            return true;\r\n        }\r\n        //第一步判断是否在位置\r\n        if (personData._pos.buildingId !== action._pos) {\r\n            personData.goToBuilding(action._pos);\r\n            return false;\r\n        }\r\n        if (!action._isDoing) {\r\n            //表示刚开始做\r\n            action._isDoing = true;\r\n            action._nowUseTime = 0;\r\n        }\r\n        return true;\r\n    };\r\n    action.timeUpdate = function (personData, addMinutes) {\r\n        if (!action._isDoing) {\r\n            return;\r\n        }\r\n        //在野外\r\n        if (personData._pos.cityId === -1) {\r\n            action._isDoing = false;\r\n            personData.goToBuilding(action._pos);\r\n            return;\r\n        }\r\n        let buildingData;\r\n        if (action._pos !== -1) {\r\n            //判断是否在使用的建筑中，没有的话需要先移动到指定建筑\r\n            buildingData = g_GameGlobalManager.gameData.getCityById(personData._pos.cityId).getBuildingById(action._pos);\r\n            if (!buildingData) {\r\n                action._isDoing = false;\r\n                personData.goToBuilding(action._pos);\r\n                return;\r\n            }\r\n        } else if (personData._pos.cityId !== personData._homePos) {\r\n            //自宅需要区别开来\r\n            action._isDoing = false;\r\n            personData.goToBuilding(action._pos);\r\n            return;\r\n        }\r\n        action._nowUseTime = action._nowUseTime + addMinutes;\r\n        if (action._nowUseTime > action._actionCostTime) {\r\n            //判断是否要使用建筑功能\r\n            if (action._pos !== -1) {\r\n                buildingData.useBuilding(personData, false);\r\n            } else {\r\n                personData.useHome();\r\n            }\r\n            personData.actionFinishCb(action);\r\n            action._isDoing = false;\r\n        }\r\n    };\r\n    //获取存储的数据\r\n    action.getSaveData = function () {\r\n        return {\r\n            id: action._id,\r\n            nowUseTime: action._nowUseTime\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * 新建一个任务\r\n */\r\nlocal.createOneAction = function (actionId) {\r\n    //配置数据\r\n    this._id = parseInt(actionId);\r\n    //任务数据\r\n    var jsonData = g_JsonDataTool.getDataById('_table_action_action', actionId);\r\n    //总用时\r\n    this._actionCostTime = jsonData.costTime;\r\n    //位置用一个数组表示，第一个元素表示城市id，第二个表示建筑id\r\n    //配置表里面只会配置一个建筑id，当前城市没有这个建筑的话就需要去寻找最近的城市\r\n    this._pos = parseInt(jsonData.pos);\r\n    //收益列表\r\n    //单数是id，双数是数量\r\n    this._rewardArr = ('' + jsonData.rewardArr).split(',');\r\n    //任务名字\r\n    this._name = jsonData.name;\r\n    //消耗体力\r\n    this._costPower = jsonData.costPower || 0;\r\n    //消耗的金钱\r\n    this._costMoney = jsonData.costMoney || 0;\r\n\r\n    //当前已执行的时间\r\n    this._nowUseTime = 0;\r\n\r\n    //新增函数\r\n    local.buildFunc(this);\r\n};\r\n\r\n/**\r\n * @param saveData 存储的数据\r\n */\r\nlocal.createOneActionSaveData = function (saveData) {\r\n    //配置数据\r\n    this._id = parseInt(saveData.id);\r\n    //任务数据\r\n    var jsonData = g_JsonDataTool.getDataById('_table_action_action', this._id);\r\n    //总用时\r\n    this._actionCostTime = jsonData.costTime;\r\n    //位置用一个数组表示，第一个元素表示城市id，第二个表示建筑id\r\n    //配置表里面只会配置一个建筑id，当前城市没有这个建筑的话就需要去寻找最近的城市\r\n    this._pos = parseInt(jsonData.pos);\r\n    //收益列表\r\n    //单数是id，双数是数量\r\n    this._rewardArr = ('' + jsonData.rewardArr).split(',');\r\n    //任务名字\r\n    this._name = jsonData.name;\r\n    //消耗体力\r\n    this._costPower = jsonData.costPower || 0;\r\n    //消耗的金钱\r\n    this._costMoney = jsonData.costMoney || 0;\r\n\r\n    //当前已执行的时间\r\n    this._nowUseTime = saveData.nowUseTime;\r\n\r\n    //新增函数\r\n    local.buildFunc(this);\r\n\r\n    //新增函数\r\n    local.buildFunc(this);\r\n};\r\n\r\n/**\r\n * @param actionId 任务id\r\n * @param saveData 存储的数据\r\n * 任务的计时\r\n */\r\noutModule.createOneAction = (actionId, saveData) => {\r\n    if (saveData) {\r\n        return new local.createOneActionSaveData(saveData);\r\n    }\r\n    return new local.createOneAction(actionId);\r\n};\r\n\r\nmodule.exports = outModule;"]}