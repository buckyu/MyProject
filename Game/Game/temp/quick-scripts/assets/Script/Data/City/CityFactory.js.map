{"version":3,"sources":["CityFactory.js"],"names":["outModule","local","BuildingFactory","require","PersonFactory","GlobalData","buildFunc","city","getBuildingById","buildingId","_buildingArr","find","oneBuildingData","_id","createOneRandomPerson","sex","cityId","cc","random0To1","SEX_MAN","SEX_WOMAN","createRandomPerson","dayUpdate","getSaveData","id","peopleNum","_peopleNum","soldierNum","_soldierNum","horseNum","_horseNum","commissariatNum","_commissariatNum","moneyNum","_moneyNum","cityDefNum","_cityDefNum","personArr","_personArr","map","onePersonData","createOneCityBySaveData","saveData","parseInt","jsonData","g_JsonDataTool","getDataById","_name","name","_cityPos","cityPos","split","num","g_GameTool","buildPos","personId","g_GameGlobalManager","gameData","getPersonById","building","createOneBuilding","undefined","createOneCity","cityDef","npc","createOneBasePerson","i","randomNpcNum","push","module","exports"],"mappings":"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","file":"CityFactory.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Data\\City","sourcesContent":["/**\r\n * 城市数据工厂\r\n */\r\nvar outModule = {};\r\nvar local = {};\r\nvar BuildingFactory = require('BuildingFactory');\r\nvar PersonFactory = require('PersonFactory');\r\nvar GlobalData = require('GlobalData');\r\n\r\n/**\r\n * @param city 为城市数据绑定相应的函数\r\n */\r\nlocal.buildFunc = function (city) {\r\n    //根据建筑id获取一个建筑\r\n    city.getBuildingById = function (buildingId) {\r\n        return this._buildingArr.find((oneBuildingData) => {\r\n            return oneBuildingData._id === buildingId;\r\n        });\r\n    };\r\n    //在这个城市新建一个随机人物\r\n    city.createOneRandomPerson = function (sex, cityId) {\r\n        sex = sex ? sex : (cc.random0To1() < 0.5 ? GlobalData.SEX_MAN : GlobalData.SEX_WOMAN);\r\n        return PersonFactory.createRandomPerson(sex, cityId);\r\n    };\r\n    //新的一天\r\n    city.dayUpdate = function () {\r\n\r\n    };\r\n    city.getSaveData = function () {\r\n        return {\r\n            id: city._id,\r\n            peopleNum: city._peopleNum,\r\n            soldierNum: city._soldierNum,\r\n            horseNum: city._horseNum,\r\n            commissariatNum: city._commissariatNum,\r\n            moneyNum: city._moneyNum,\r\n            cityDefNum: city._cityDefNum,\r\n            personArr: city._personArr.map(function (onePersonData) {\r\n                return onePersonData._id;\r\n            })\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * @param saveData 存储的数据\r\n */\r\nlocal.createOneCityBySaveData = function (saveData) {\r\n    //城市id\r\n    this._id = parseInt(saveData.id);\r\n    //配置数据\r\n    var jsonData = g_JsonDataTool.getDataById('_table_city_city', this._id);\r\n    //居民数量\r\n    this._peopleNum = saveData.peopleNum;\r\n    //军队数量\r\n    this._soldierNum = saveData.soldierNum;\r\n    //马匹数量\r\n    this._horseNum = saveData.horseNum;\r\n    //粮食数量\r\n    //一个人一天需要消耗1的粮食\r\n    this._commissariatNum = saveData.commissariatNum;\r\n    //金币数量\r\n    this._moneyNum = saveData.moneyNum;\r\n    //城市防御\r\n    this._cityDefNum = saveData.cityDefNum;\r\n    //城市名字\r\n    this._name = jsonData.name;\r\n    //城市位置\r\n    //用两个元素表示，类似于经纬度\r\n    this._cityPos = jsonData.cityPos.split(',').map(function (num) {\r\n        return parseInt(num);\r\n    });\r\n    this._cityPos = g_GameTool.buildPos(this._cityPos[0], this._cityPos[1]);\r\n\r\n    local.buildFunc(this);\r\n\r\n    //人物列表\r\n    //表示家在这个城市的人\r\n    this._personArr = saveData.personArr.map((personId) => {\r\n        return g_GameGlobalManager.gameData.getPersonById(personId);\r\n    });\r\n    //建筑列表\r\n    this._buildingArr = ('' + jsonData.building).split(',').map((buildingId) => {\r\n        return BuildingFactory.createOneBuilding(buildingId, undefined);\r\n    });\r\n};\r\n\r\n/**\r\n * @param cityId 城市id\r\n * 新建一个城市数据\r\n * 城市内有一个特殊的情况就是人会处于自宅，这个自宅标记为-1\r\n */\r\nlocal.createOneCity = function (cityId) {\r\n    //城市id\r\n    this._id = parseInt(cityId);\r\n    //配置数据\r\n    var jsonData = g_JsonDataTool.getDataById('_table_city_city', cityId);\r\n    //居民数量\r\n    this._peopleNum = jsonData.peopleNum;\r\n    //军队数量\r\n    this._soldierNum = jsonData.soldierNum;\r\n    //马匹数量\r\n    this._horseNum = jsonData.horseNum;\r\n    //粮食数量\r\n    //一个人一天需要消耗1的粮食\r\n    this._commissariatNum = jsonData.commissariatNum;\r\n    //金币数量\r\n    this._moneyNum = jsonData.moneyNum;\r\n    //城市防御\r\n    this._cityDefNum = jsonData.cityDef;\r\n    //城市名字\r\n    this._name = jsonData.name;\r\n    //城市位置\r\n    //用两个元素表示，类似于经纬度\r\n    this._cityPos = jsonData.cityPos.split(',').map(function (num) {\r\n        return parseInt(num);\r\n    });\r\n    this._cityPos = g_GameTool.buildPos(this._cityPos[0], this._cityPos[1]);\r\n\r\n    local.buildFunc(this);\r\n\r\n    //人物列表\r\n    this._personArr = ('' + jsonData.npc).split(',').map((personId) => {\r\n        return PersonFactory.createOneBasePerson(personId, undefined, this._id);\r\n    });\r\n    //随机人物\r\n    for (let i = 0; i < jsonData.randomNpcNum; i++) {\r\n        this._personArr.push(this.createOneRandomPerson(undefined, this._id));\r\n    }\r\n    //建筑列表\r\n    this._buildingArr = ('' + jsonData.building).split(',').map((buildingId) => {\r\n        return BuildingFactory.createOneBuilding(buildingId, undefined);\r\n    });\r\n};\r\n\r\n/**\r\n * @param cityId\r\n * @param saveData \r\n */\r\noutModule.createOneCity = (cityId, saveData) => {\r\n    if (saveData) {\r\n        return new local.createOneCityBySaveData(saveData);\r\n    }\r\n    return new local.createOneCity(cityId);\r\n};\r\n\r\nmodule.exports = outModule;"]}